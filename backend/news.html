<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>News API Tester</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

  <div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4 text-center">üì∞ News API Tester</h1>

    <!-- Upload Form -->
    <form id="uploadForm" class="space-y-4 mb-6">
      <div>
        <label class="block font-semibold">Title</label>
        <input type="text" id="title" class="w-full border rounded p-2" required>
      </div>
      <div>
        <label class="block font-semibold">Company</label>
        <input type="text" id="company" class="w-full border rounded p-2" required>
      </div>
      <div>
        <label class="block font-semibold">Image</label>
        <input type="file" id="image" accept="image/*" class="w-full" required>
      </div>
      <div>
        <label class="block font-semibold">Video</label>
        <input type="file" id="video" accept="video/*" class="w-full" required>
      </div>
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
        Upload News
      </button>
    </form>

    <!-- News List -->
    <div>
      <h2 class="text-xl font-semibold mb-2">üìã All News</h2>
      <div id="newsList" class="space-y-4"></div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:8000/targetcomplex/news';

    // Upload news
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      formData.append('title', document.getElementById('title').value);
      formData.append('company', document.getElementById('company').value);
      formData.append('file', document.getElementById('image').files[0]);
      formData.append('file', document.getElementById('video').files[0]);

      try {
        const res = await fetch(`${API_URL}/upload`, {
          method: 'POST',
          body: formData
        });

        const data = await res.json();

        if (!res.ok) throw new Error(data.message || 'Upload failed');

        Swal.fire('‚úÖ Success', 'News uploaded!', 'success');
        document.getElementById('uploadForm').reset();
        loadNews();
      } catch (err) {
        Swal.fire('‚ùå Error', err.message, 'error');
      }
    });

    // Load news
    async function loadNews() {
      const res = await fetch(API_URL);
      const news = await res.json();
      const container = document.getElementById('newsList');
      container.innerHTML = '';

      if (!news.length) {
        container.innerHTML = '<p class="text-gray-500">No news available.</p>';
        return;
      }

      news.forEach(item => {
        const div = document.createElement('div');
        div.className = 'p-4 border rounded bg-gray-50 space-y-2';

        div.innerHTML = `
          <h3 class="text-lg font-semibold">${item.title}</h3>
          <p><strong>Company:</strong> ${item.company}</p>
          <img src="${item.image}" class="w-32 h-32 object-cover rounded">
          <video src="${item.video}" class="w-64 mt-2" controls></video>

          <div class="space-x-2 mt-3">
            <button onclick="editNews('${item._id}', '${item.title}', '${item.company}')" class="bg-yellow-500 text-white px-3 py-1 rounded">Edit</button>
            <button onclick="deleteNews('${item._id}')" class="bg-red-600 text-white px-3 py-1 rounded">Delete</button>
          </div>
        `;

        container.appendChild(div);
      });
    }

    // Delete news
    async function deleteNews(id) {
      const confirm = await Swal.fire({
        title: 'Delete this news?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, delete it'
      });

      if (!confirm.isConfirmed) return;

      const res = await fetch(`${API_URL}/${id}`, {
        method: 'DELETE'
      });

      const data = await res.json();

      if (res.ok) {
        Swal.fire('Deleted!', data.message, 'success');
        loadNews();
      } else {
        Swal.fire('Error', data.message, 'error');
      }
    }

    // Edit news
    async function editNews(id, currentTitle, currentCompany) {
      const { value: formValues } = await Swal.fire({
        title: 'Edit News',
        html: `
          <input id="swal-title" class="swal2-input" placeholder="Title" value="${currentTitle}">
          <input id="swal-company" class="swal2-input" placeholder="Company" value="${currentCompany}">
        `,
        focusConfirm: false,
        showCancelButton: true,
        preConfirm: () => {
          return {
            title: document.getElementById('swal-title').value,
            company: document.getElementById('swal-company').value
          };
        }
      });

      if (!formValues) return;

      const res = await fetch(`${API_URL}/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formValues)
      });

      const data = await res.json();

      if (res.ok) {
        Swal.fire('Updated!', 'News updated successfully.', 'success');
        loadNews();
      } else {
        Swal.fire('Error', data.message, 'error');
      }
    }

    // Load news on page load
    loadNews();
  </script>
</body>
</html>
